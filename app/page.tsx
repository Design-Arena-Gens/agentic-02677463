'use client';
import { useCallback, useEffect, useMemo, useRef, useState } from 'react';
import AnimationCanvas from '@/components/AnimationCanvas';
import AudioController, { HindiLine } from '@/components/AudioController';

export default function Page() {
  const [started, setStarted] = useState(false);
  const [speaking, setSpeaking] = useState(false);
  const [musicOn, setMusicOn] = useState(true);
  const [currentCaption, setCurrentCaption] = useState('');

  const lines: HindiLine[] = useMemo(() => [
    { t: 0, text: '??? ???? ??, ?? ???? ????? ???? ?? ?????' },
    { t: 5.5, text: '??? ??? ?? ????? ???, ?? ???? ?????? ?????? ????' },
    { t: 11, text: '?? ????? ????????? ???? ???? ??? ????? ????' },
    { t: 16.5, text: '?? ????? ?????, ?? ???? ???????????? ???? ????' },
    { t: 22, text: '????-????, ??? ????? ?? ?? ????? ????? ???' },
    { t: 27.5, text: '?? ???? ??? ???????????? ??????? ??? ???? ??????' }
  ], []);

  const onStart = useCallback(() => setStarted(true), []);
  const onCaption = useCallback((text: string) => setCurrentCaption(text), []);

  useEffect(() => {
    if (!started) setCurrentCaption('???? ???? ?? ??? ???? ?????');
  }, [started]);

  return (
    <div className="container">
      <div className="header">
        <div className="title">??? ?? ?????</div>
        <div className="badge">Cinematic ? 2D ? Hindi</div>
      </div>

      <main className="main">
        <div className="canvasWrap">
          <AnimationCanvas started={started} caption={currentCaption} />
          {currentCaption && <div className="caption">{currentCaption}</div>}
        </div>

        <div className="controls">
          <AudioController
            started={started}
            onStart={onStart}
            lines={lines}
            musicOn={musicOn}
            speaking={speaking}
            onSpeakingChange={setSpeaking}
            onCaption={onCaption}
          />
          <button className="secondary" onClick={() => setMusicOn(v => !v)}>
            {musicOn ? '????? ??? ????' : '????? ???? ????'}
          </button>
        </div>
      </main>

      <div className="footer">
        <span className="small">Soft golden lighting ? Dark brown palette ? Smooth animation</span>
        <a className="link" href="https://vercel.com" target="_blank" rel="noreferrer">Powered by Vercel</a>
      </div>
    </div>
  );
}
